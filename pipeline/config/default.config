import nextflow.util.SysHelper

// Default inputs/parameters of the pipeline
params {

    max_cpus   = SysHelper.getAvailCpus()
    max_memory = SysHelper.getAvailMemory()

    ucla_cds = true

    // tools and their versions
    bwa_version = "BWA-MEM2-2.2.1"
    hisat2_version = "HISAT2-2.2.1"

    docker_image_bwa_and_samtools = "blcdsdockerregistry/bwa-mem2_samtools-1.12:2.2.1"
    docker_image_hisat2_and_samtools = "blcdsdockerregistry/hisat2_samtools-1.12:2.2.1"
    docker_image_picardtools = "blcdsdockerregistry/picard:2.26.10"
    docker_image_sha512sum = "blcdsdockerregistry/align-dna:sha512sum-1.0"
    docker_image_validate_params = "blcdsdockerregistry/validate:2.1.5"    
    docker_image_gatk = "broadinstitute/gatk:4.2.4.1"
    }

if (!params.containsKey('check_node_config')) {
    // Set to false for testing on nodes that don't match the
    // pre-configured F2/F32/F72/M64.
    // Removing this variable has the same effect as setting it to `true`.
    params.check_node_config = true
    }

if (!params.containsKey('aligner')) {
    params.aligner = ["BWA-MEM2"]
    params.reference_fasta_bwa = params.reference_fasta
    params.reference_fasta_index_files_bwa = "${params.reference_fasta_bwa}.*"
    if (!params.containsKey('reference_fasta_index_files_bwa')) {
        params.reference_fasta_index_files_bwa = "${params.reference_fasta_bwa}.fai"
        }
    }
else {
   if (params.aligner.contains("BWA-MEM2")) {
       if (!params.containsKey('reference_fasta_index_files_bwa')) {
           params.reference_fasta_index_files_bwa = "${params.reference_fasta_bwa}.*"
           }
       if (!params.containsKey('reference_fasta_index_files_bwa')) {
           params.reference_fasta_index_files_bwa = "${params.reference_fasta_bwa}.fai"
           }   
       }

   if (params.aligner.contains('HISAT2')) {
       params.reference_fasta_index_files_hisat2 = "${params.hisat2_index_prefix}.*.ht2"
       }
   }

if (!params.containsKey('mark_duplicates')) {
    params.mark_duplicates = true
    }

// Enable Docker and configure docker-related options like user and group IDs
docker {
    enabled = true
    uid_and_gid = "-u \$(id -u):\$(id -g)"
    all_group_ids = "\$(for i in `id --real --groups`; do echo -n \"--group-add=\$i \"; done)"

    // Do we still need this?
    sudo = false

    runOptions = "${uid_and_gid} ${all_group_ids}"
    }